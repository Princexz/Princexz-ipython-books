<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IPython Cookbook, ">


    <!-- FAVICON -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">


        <link rel="alternate"  href="https://ipython-books.github.io/feeds/all.atom.xml" type="application/atom+xml" title="IPython Cookbook Full Atom Feed"/>

        <title>IPython Cookbook - 1.5. Mastering IPython's configuration system</title>

    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
    <!--<![endif]-->
    <link rel="stylesheet" href="https://ipython-books.github.io/theme/css/styles.css">
    <link rel="stylesheet" href="https://ipython-books.github.io/theme/css/pygments.css">
    <!-- <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'> -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,500" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
</head>

<body>


    <header id="header" class="pure-g">
        <div class="pure-u-1 pure-u-md-3-4">
             <div id="menu">
                 <div class="pure-menu pure-menu-open pure-menu-horizontal">
<ul>
        <li><a href="/">home</a></li>
        <li><a href="https://github.com/ipython-books/cookbook-2nd-code">Jupyter notebooks</a></li>
        <li><a href="https://github.com/ipython-books/minibook-2nd-code">minibook</a></li>
        <li><a href="https://cyrille.rossant.net">author</a></li>
</ul>                </div>
            </div>
        </div>

        <div class="pure-u-1 pure-u-md-1-4">
            <div id="social">
                <div class="pure-menu pure-menu-open pure-menu-horizontal">
<ul>
        <li><a href="https://twitter.com/cyrillerossant"><i class="fa fa-twitter"></i></a></li>
        <li><a href="https://github.com/ipython-books/cookbook-2nd"><i class="fa fa-github"></i></a></li>
</ul>                </div>
            </div>
        </div>
    </header>
       

    
    <div id="layout" class="pure-g">
        <section id="content" class="pure-u-1 pure-u-md-4-4">
            <div class="l-box">

    <header id="page-header">
        <h1>1.5. Mastering IPython's configuration system</h1>
    </header>

    <section id="page">
        <p><a href="/"><img src="https://raw.githubusercontent.com/ipython-books/cookbook-2nd/master/cover-cookbook-2nd.png" align="left" alt="IPython Cookbook, Second Edition" height="130" style="margin-right: 20px; margin-bottom: 10px;" /></a> <em>This is one of the 100+ free recipes of the <a href="/">IPython Cookbook, Second Edition</a>, by <a href="http://cyrille.rossant.net">Cyrille Rossant</a>, a guide to numerical computing and data science in the Jupyter Notebook. The ebook and printed book are available for purchase at <a href="https://www.packtpub.com/big-data-and-business-intelligence/ipython-interactive-computing-and-visualization-cookbook-second-e">Packt Publishing</a>.</em></p>
<p>▶&nbsp;&nbsp;<em><a href="https://github.com/ipython-books/cookbook-2nd">Text on GitHub</a> with a <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/us/legalcode">CC-BY-NC-ND license</a></em><br />
▶&nbsp;&nbsp;<em><a href="https://github.com/ipython-books/cookbook-2nd-code">Code on GitHub</a> with a <a href="https://opensource.org/licenses/MIT">MIT license</a></em></p>
<p>▶&nbsp;&nbsp;<a href="https://ipython-books.github.io/chapter-1-a-tour-of-interactive-computing-with-jupyter-and-ipython/"><strong><em>Go to</em></strong> <em>Chapter 1 : A Tour of Interactive Computing with Jupyter and IPython</em></a><br />
▶&nbsp;&nbsp;<a href="https://github.com/ipython-books/cookbook-2nd-code/blob/master/chapter01_basic/05_config.ipynb"><em><strong>Get</strong> the Jupyter notebook</em></a>  </p>
<p>The <strong>traitlets</strong> package (https://traitlets.readthedocs.io/en/stable/), originated from IPython, implements a powerful configuration system. This system is used throughout the project, but it can also be used by IPython extensions. It could even be used in entirely new applications.</p>
<p>In this recipe, we show how to use this system to write a configurable IPython extension. We will create a simple magic command that displays random numbers. This magic command comes with configurable parameters that can be set by the user in their IPython configuration file.</p>
<h2>How to do it...</h2>
<p><strong>1.&nbsp;</strong> We create an IPython extension in a <code>random_magics.py</code> file. Let's start by importing a few objects:</p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">random_magics</span><span class="o">.</span><span class="n">py</span>

<span class="kn">from</span> <span class="nn">traitlets</span> <span class="kn">import</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Unicode</span><span class="p">,</span> <span class="n">Bool</span>
<span class="kn">from</span> <span class="nn">IPython.core.magic</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Magics</span><span class="p">,</span> <span class="n">magics_class</span><span class="p">,</span>
                                <span class="n">line_magic</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>


<div class="highlight"><pre><span></span>Writing random_magics.py
</pre></div>


<p><strong>2.&nbsp;</strong> We create a <code>RandomMagics</code> class deriving from <code>Magics</code>. This class contains a few configurable parameters:</p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">random_magics</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span>

<span class="nd">@magics_class</span>
<span class="k">class</span> <span class="nc">RandomMagics</span><span class="p">(</span><span class="n">Magics</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">Unicode</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;{n}&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Appending to random_magics.py
</pre></div>


<p><strong>3.&nbsp;</strong> We need to call the parent's constructor. Then, we initialize a random number generator with a seed:</p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">random_magics</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shell</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomMagics</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Appending to random_magics.py
</pre></div>


<p><strong>4.&nbsp;</strong> We create a <code>%random</code> line magic that displays a random number:</p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">random_magics</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span>

    <span class="nd">@line_magic</span>
    <span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>Appending to random_magics.py
</pre></div>


<p><strong>5.&nbsp;</strong> Finally, we register that magic when the extension is loaded:</p>
<div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">random_magics</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span>

<span class="k">def</span> <span class="nf">load_ipython_extension</span><span class="p">(</span><span class="n">ipython</span><span class="p">):</span>
    <span class="n">ipython</span><span class="o">.</span><span class="n">register_magics</span><span class="p">(</span><span class="n">RandomMagics</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Appending to random_magics.py
</pre></div>


<p><strong>6.&nbsp;</strong> Let's test our extension in the Notebook:</p>
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">random_magics</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">random</span>
</pre></div>


<div class="highlight"><pre><span></span>&#39;430&#39;
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">random</span>
</pre></div>


<div class="highlight"><pre><span></span>&#39;305&#39;
</pre></div>


<p><strong>7.&nbsp;</strong> Our magic command has a few configurable parameters. These variables are meant to be configured by the user in the IPython configuration file or in the console when starting IPython. To configure these variables in the terminal, we can type the following command in a system shell:</p>
<div class="highlight"><pre><span></span>ipython --RandomMagics.text=&#39;Your number is {n}.&#39; \
        --RandomMagics.max=10 \
        --RandomMagics.seed=1
</pre></div>


<p>In that session, <code>%random</code> displays a string like <code>'Your number is 5.'</code>.</p>
<p><strong>8.&nbsp;</strong> To configure the variables in the IPython configuration file, we open the <code>~/.ipython/profile_default/ipython_config.py</code> file and add the following line:</p>
<div class="highlight"><pre><span></span>c.RandomMagics.text = &#39;random {n}&#39;
</pre></div>


<p>After launching IPython, <code>%random</code> prints a string like <code>random 652</code>.</p>
<h2>How it works...</h2>
<p>IPython's configuration system defines several concepts:</p>
<ul>
<li>A <strong>user profile</strong> is a set of parameters, logs, and command history, which are specific to a user. A user can have different profiles when working on different projects. A <code>xxx</code> profile is stored in <code>~/.ipython/profile_xxx</code>, where <code>~</code> is the user's home directory.<ul>
<li>On Linux, the path should be <code>/home/yourname/.ipython/profile_xxx</code></li>
<li>On macOS, the path should be <code>/Users/yourname/.ipython/profile_xxx</code></li>
<li>On Windows, the path should be <code>C:\Users\YourName\.ipython\profile_xxx</code></li>
</ul>
</li>
<li>A <strong>configuration object</strong>, or <code>Config</code>, is a special Python dictionary that contains key-value pairs. The <code>Config</code> class derives from Python's <code>dict</code>.</li>
<li>The <code>HasTraits</code> class is a class that can have special <code>trait</code> attributes. <strong>Traits</strong> are sophisticated Python attributes that have a specific type and a default value. Additionally, when a trait's value changes, a callback function is automatically and transparently called. This mechanism allows a class to be notified whenever a trait attribute is changed.</li>
<li>A <code>Configurable</code> class is the base class of all classes that want to benefit from the configuration system. A <code>Configurable</code> class can have configurable attributes. These attributes have default values specified directly in the class definition. The main feature of <code>Configurable</code> classes is that the default values of the traits can be overridden by configuration files on a class-by-class basis. Then, instances of Configurables can change these values at leisure.</li>
<li>A <strong>configuration file</strong> is a Python or JSON file that contains the parameters of <code>Configurable</code> classes.</li>
</ul>
<p>The <code>Configurable</code> classes and configuration files support an inheritance model. A <code>Configurable</code> class can derive from another <code>Configurable</code> class and override its parameters. Similarly, a configuration file can be included in another file.</p>
<h3>Configurables</h3>
<p>Here is a simple example of a <code>Configurable</code> class:</p>
<div class="highlight"><pre><span></span>from traitlets.config import Configurable
from traitlets import Float

class MyConfigurable(Configurable):
    myvariable = Float(100.0, config=True)
</pre></div>


<p>By default, an instance of the <code>MyConfigurable</code> class will have its <code>myvariable</code> attribute equal to 100. Now, let's assume that our IPython configuration file contains the following lines:</p>
<div class="highlight"><pre><span></span>c = get_config()
c.MyConfigurable.myvariable = 123.
</pre></div>


<p>Then, the <code>myvariable</code> attribute will default to 123. Instances are free to change this default value after they are instantiated.</p>
<p>The <code>get_config()</code> function is a special function that is available in any configuration file.</p>
<p>Additionally, <code>Configurable</code> parameters can be specified in the command-line interface, as we saw in this recipe.</p>
<p>This configuration system is used by all IPython applications (notably <code>console</code>, <code>qtconsole</code>, and <code>notebook</code>). These applications have many configurable attributes. You will find the list of these attributes in your profile's configuration files.</p>
<h3>Magics</h3>
<p>The <strong>Magics</strong> class derives from <code>Configurable</code> and can contain configurable attributes. Moreover, magic commands can be defined by methods decorated by <code>@line_magic</code> or <code>@cell_magic</code>. The advantage of defining class magics instead of function magics (as in the previous recipe) is that we can keep a state between multiple magic calls (because we are using a class instead of a function).</p>
<h2>There's more...</h2>
<p>Here are a few references:</p>
<ul>
<li>Configuring and customizing IPython at <a href="http://ipython.readthedocs.io/en/stable/config/">http://ipython.readthedocs.io/en/stable/config/</a></li>
<li>Defining custom magics available at <a href="http://ipython.readthedocs.io/en/stable/config/custommagics.html">http://ipython.readthedocs.io/en/stable/config/custommagics.html</a></li>
<li>Detailed overview of the configuration system at <a href="https://traitlets.readthedocs.io/en/stable/config.html">https://traitlets.readthedocs.io/en/stable/config.html</a></li>
</ul>
<h2>See also</h2>
<ul>
<li>Creating an IPython extension with custom magic commands</li>
</ul>
    </section>

            </div>
        </section>

        <footer id="footer" class="pure-u-1 pure-u-md-4-4">
            <div class="l-box">
                <div>
                    <p>&copy; <a href="https://cyrille.rossant.net">Cyrille Rossant</a> &ndash;
                        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
                        for <a href="https://blog.getpelican.com/">Pelican</a>
                    </p>
                </div>
            </div>
        </footer>
        
    </div>
    
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9752080; 
var sc_invisible=1; 
var sc_security="c177b501"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="//c.statcounter.com/9752080/0/c177b501/1/" alt="Web
Analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</body>
</html>